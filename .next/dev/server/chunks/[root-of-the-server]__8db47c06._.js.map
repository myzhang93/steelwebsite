{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/111work/steel-website-clone%20%281%29/app/api/wordpress/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\n\n// WordPress 站点 URL\nconst WORDPRESS_URL = process.env.WORDPRESS_URL || 'https://lynsteel.com'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n\n    if (!id) {\n      return NextResponse.json(\n        { error: 'Post ID is required' },\n        { status: 400 }\n      )\n    }\n\n    console.log('Fetching WordPress content for ID:', id, 'from:', WORDPRESS_URL)\n\n    // 尝试多种文章类型：自定义类型 zzproduct、posts、pages\n    const postTypes = ['zzproduct', 'posts', 'pages']\n    \n    for (const postType of postTypes) {\n      const url = `${WORDPRESS_URL}/wp-json/wp/v2/${postType}/${id}?_embed`\n      console.log(`Trying ${postType} URL:`, url)\n      \n      try {\n        const response = await fetch(url, {\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n          },\n          next: { revalidate: 60 },\n        })\n\n        console.log(`${postType} response status:`, response.status, response.statusText)\n\n        if (response.ok) {\n          const data = await response.json()\n          console.log(`${postType} data fetched successfully`)\n          return NextResponse.json(formatWordPressData(data))\n        } else {\n          // 如果不是最后一个类型，继续尝试下一个\n          if (postType !== postTypes[postTypes.length - 1]) {\n            console.log(`${postType} not found, trying next type...`)\n            continue\n          }\n        }\n      } catch (fetchError: any) {\n        console.error(`Error fetching ${postType}:`, fetchError)\n        // 如果是最后一个类型，返回网络错误\n        if (postType === postTypes[postTypes.length - 1]) {\n          return NextResponse.json(\n            { \n              error: 'Network error when fetching from WordPress',\n              details: fetchError.message || 'Failed to connect to WordPress',\n              wordpressUrl: WORDPRESS_URL,\n              postId: id\n            },\n            { status: 500 }\n          )\n        }\n        // 否则继续尝试下一个类型\n        continue\n      }\n    }\n\n    // 如果所有类型都失败了\n    return NextResponse.json(\n      { \n        error: 'Post or page not found',\n        details: 'Unable to find content in any post type (zzproduct, posts, pages)',\n        wordpressUrl: WORDPRESS_URL,\n        postId: id\n      },\n      { status: 404 }\n    )\n    \n  } catch (error: any) {\n    console.error('Error fetching WordPress content:', error)\n    console.error('Error details:', {\n      message: error.message,\n      stack: error.stack,\n      cause: error.cause\n    })\n    return NextResponse.json(\n      { \n        error: 'Failed to fetch WordPress content',\n        details: error.message || 'Unknown error',\n        wordpressUrl: WORDPRESS_URL\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// 格式化 WordPress 数据\nfunction formatWordPressData(data: any) {\n  // 提取特色图片\n  let featuredImage = null\n  if (data._embedded?.['wp:featuredmedia']?.[0]?.source_url) {\n    featuredImage = data._embedded['wp:featuredmedia'][0].source_url\n  }\n\n  // 提取内容中的图片\n  const content = data.content?.rendered || ''\n  const imageMatches = content.match(/<img[^>]+src=\"([^\"]+)\"/g)\n  const images: string[] = []\n  if (imageMatches) {\n    imageMatches.forEach((match: string) => {\n      const srcMatch = match.match(/src=\"([^\"]+)\"/)\n      if (srcMatch && srcMatch[1]) {\n        images.push(srcMatch[1])\n      }\n    })\n  }\n\n  // 提取纯文本内容（去除 HTML 标签）\n  const textContent = content\n    .replace(/<[^>]*>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .trim()\n\n  // 提取分类\n  const categories: string[] = []\n  if (data._embedded?.['wp:term']?.[0]) {\n    data._embedded['wp:term'][0].forEach((term: any) => {\n      if (term.taxonomy === 'category') {\n        categories.push(term.name)\n      }\n    })\n  }\n\n  // 提取标签\n  const tags: string[] = []\n  if (data._embedded?.['wp:term']?.[1]) {\n    data._embedded['wp:term'][1].forEach((term: any) => {\n      if (term.taxonomy === 'post_tag') {\n        tags.push(term.name)\n      }\n    })\n  }\n\n  // 提取作者\n  let author = ''\n  if (data._embedded?.author?.[0]) {\n    author = data._embedded.author[0].name || ''\n  }\n\n  return {\n    id: data.id,\n    title: data.title?.rendered || data.title || '',\n    content: data.content?.rendered || '',\n    excerpt: data.excerpt?.rendered || '',\n    textContent: textContent,\n    featuredImage: featuredImage,\n    images: images,\n    date: data.date,\n    modified: data.modified,\n    link: data.link,\n    author: author,\n    categories: categories,\n    tags: tags,\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}