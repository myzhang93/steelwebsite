{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///D:/111work/steel-website-clone%20%281%29/lib/email.ts"],"sourcesContent":["import nodemailer from 'nodemailer'\n\n// åˆ›å»ºé‚®ä»¶ä¼ è¾“å™¨\nconst createTransporter = () => {\n  // é»˜è®¤ä½¿ç”¨ QQ é‚®ç®±é…ç½®\n  const host = process.env.SMTP_HOST || 'smtp.qq.com'\n  const port = parseInt(process.env.SMTP_PORT || '587')\n  const secure = process.env.SMTP_SECURE === 'true' || port === 465\n  \n  return nodemailer.createTransport({\n    host,\n    port,\n    secure, // true for 465, false for other ports\n    auth: {\n      user: process.env.SMTP_USER,\n      pass: process.env.SMTP_PASS, // QQ é‚®ç®±éœ€è¦ä½¿ç”¨æˆæƒç ï¼Œä¸æ˜¯å¯†ç \n    },\n  })\n}\n\n// å‘é€è¡¨å•æäº¤é€šçŸ¥é‚®ä»¶\nexport async function sendQuoteEmail(data: {\n  name: string\n  phone?: string\n  email: string\n  message?: string\n  attachment?: {\n    filename: string\n    content: Buffer\n    contentType?: string\n  }\n}) {\n  const transporter = createTransporter()\n\n  // æ”¶ä»¶äººé‚®ç®±ï¼ˆä»ç¯å¢ƒå˜é‡è·å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼‰\n  const recipientEmail = process.env.RECIPIENT_EMAIL || '1011300569@qq.com'\n\n  // æ„å»ºé™„ä»¶æ•°ç»„\n  // nodemailer ä¼šè‡ªåŠ¨å¤„ç† Buffer çš„ç¼–ç \n  const attachments = data.attachment ? [{\n    filename: data.attachment.filename,\n    content: data.attachment.content,\n    contentType: data.attachment.contentType,\n    // ç¡®ä¿é™„ä»¶å¯ä»¥æ­£å¸¸ä¸‹è½½å’Œæ‰“å¼€\n    contentDisposition: 'attachment',\n    // å¯¹äºä¸­æ–‡æ–‡ä»¶åï¼Œä½¿ç”¨ RFC 2047 ç¼–ç \n    // nodemailer ä¼šè‡ªåŠ¨å¤„ç†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç¡®ä¿æ–‡ä»¶åæ­£ç¡®\n  }] : []\n\n  // é‚®ä»¶å†…å®¹\n  const mailOptions = {\n    from: process.env.SMTP_FROM || process.env.SMTP_USER,\n    to: recipientEmail,\n    replyTo: data.email, // å›å¤åœ°å€è®¾ç½®ä¸ºæäº¤è€…çš„é‚®ç®±\n    subject: `New Quote Request from ${data.name}${data.attachment ? ' (with attachment)' : ''}`,\n    html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #1f2937; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;\">\n          New Quote Request\n        </h2>\n        \n        <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n          <h3 style=\"color: #374151; margin-top: 0;\">Contact Information</h3>\n          \n          <p style=\"margin: 10px 0;\">\n            <strong style=\"color: #1f2937;\">Name:</strong> \n            <span style=\"color: #4b5563;\">${data.name}</span>\n          </p>\n          \n          <p style=\"margin: 10px 0;\">\n            <strong style=\"color: #1f2937;\">Email:</strong> \n            <a href=\"mailto:${data.email}\" style=\"color: #3b82f6; text-decoration: none;\">${data.email}</a>\n          </p>\n          \n          ${data.phone ? `\n          <p style=\"margin: 10px 0;\">\n            <strong style=\"color: #1f2937;\">Phone:</strong> \n            <a href=\"tel:${data.phone}\" style=\"color: #4b5563; text-decoration: none;\">${data.phone}</a>\n          </p>\n          ` : ''}\n        </div>\n        \n        ${data.message ? `\n        <div style=\"background-color: #ffffff; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;\">\n          <h3 style=\"color: #374151; margin-top: 0;\">Message</h3>\n          <p style=\"color: #4b5563; line-height: 1.6; white-space: pre-wrap;\">${data.message}</p>\n        </div>\n        ` : ''}\n        \n        ${data.attachment ? `\n        <div style=\"background-color: #eff6ff; padding: 15px; border: 1px solid #3b82f6; border-radius: 8px; margin: 20px 0;\">\n          <h3 style=\"color: #374151; margin-top: 0;\">ğŸ“ Attachment</h3>\n          <p style=\"color: #4b5563; margin: 5px 0;\">\n            <strong>File:</strong> ${data.attachment.filename}\n          </p>\n          <p style=\"color: #6b7280; font-size: 12px; margin: 5px 0;\">\n            The file is attached to this email.\n          </p>\n        </div>\n        ` : ''}\n        \n        <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 12px;\">\n          <p>This email was sent from the contact form on your website.</p>\n          <p>Submitted at: ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Shanghai' })}</p>\n        </div>\n      </div>\n    `,\n    text: `\nNew Quote Request\n\nContact Information:\nName: ${data.name}\nEmail: ${data.email}\n${data.phone ? `Phone: ${data.phone}` : ''}\n\n${data.message ? `Message:\\n${data.message}` : ''}\n\n${data.attachment ? `\\nAttachment: ${data.attachment.filename}\\n` : ''}\n\n---\nThis email was sent from the contact form on your website.\nSubmitted at: ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Shanghai' })}\n    `.trim(),\n    attachments,\n  }\n\n  try {\n    // è®°å½•é™„ä»¶ä¿¡æ¯ç”¨äºè°ƒè¯•\n    if (data.attachment) {\n      console.log('Sending email with attachment:', {\n        filename: data.attachment.filename,\n        contentType: data.attachment.contentType,\n        size: data.attachment.content.length,\n      })\n    }\n    \n    const info = await transporter.sendMail(mailOptions)\n    console.log('Email sent successfully:', info.messageId)\n    console.log('Email response:', {\n      messageId: info.messageId,\n      response: info.response,\n      accepted: info.accepted,\n      rejected: info.rejected,\n    })\n    return { success: true, messageId: info.messageId }\n  } catch (error: any) {\n    console.error('Error sending email:', error)\n    console.error('Error details:', {\n      message: error.message,\n      code: error.code,\n      command: error.command,\n    })\n    throw new Error(`Failed to send email: ${error.message}`)\n  }\n}\n\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 288, "column": 0}, "map": {"version":3,"sources":["file:///D:/111work/steel-website-clone%20%281%29/app/api/quote/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { sendQuoteEmail } from '@/lib/email'\n\nexport async function POST(request: NextRequest) {\n  try {\n    // å¤„ç† FormDataï¼ˆæ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼‰\n    const formData = await request.formData()\n    \n    const name = formData.get(\"Field19\") as string\n    const phone = formData.get(\"Field12\") as string | null\n    const email = formData.get(\"Field23\") as string\n    const message = formData.get(\"Field21\") as string | null\n    const file = formData.get(\"Field9\") as File | null\n\n    // éªŒè¯å¿…å¡«å­—æ®µ\n    if (!name || !email) {\n      return NextResponse.json(\n        { error: 'Name and email are required' },\n        { status: 400 }\n      )\n    }\n\n    // éªŒè¯é‚®ç®±æ ¼å¼\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(email)) {\n      return NextResponse.json(\n        { error: 'Invalid email format' },\n        { status: 400 }\n      )\n    }\n\n    // å¤„ç†æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰\n    let fileBuffer: Buffer | null = null\n    let fileName: string | null = null\n    let fileType: string | null = null\n\n    if (file && file.size > 0) {\n      // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º 50MBï¼‰\n      const maxSize = 50 * 1024 * 1024 // 50MB\n      if (file.size > maxSize) {\n        return NextResponse.json(\n          { error: 'File size exceeds 50MB limit' },\n          { status: 400 }\n        )\n      }\n\n      // å°†æ–‡ä»¶è½¬æ¢ä¸º Buffer\n      const bytes = await file.arrayBuffer()\n      fileBuffer = Buffer.from(bytes)\n      fileName = file.name\n      fileType = file.type || 'application/octet-stream'\n      \n      // å¦‚æœæ²¡æœ‰æ–‡ä»¶ç±»å‹ï¼Œæ ¹æ®æ‰©å±•åæ¨æ–­\n      if (!file.type && fileName) {\n        const ext = fileName.split('.').pop()?.toLowerCase()\n        const mimeTypes: Record<string, string> = {\n          'jpg': 'image/jpeg',\n          'jpeg': 'image/jpeg',\n          'png': 'image/png',\n          'gif': 'image/gif',\n          'pdf': 'application/pdf',\n          'doc': 'application/msword',\n          'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n          'xls': 'application/vnd.ms-excel',\n          'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n        }\n        if (ext && mimeTypes[ext]) {\n          fileType = mimeTypes[ext]\n        }\n      }\n      \n      console.log('File received:', {\n        name: fileName,\n        type: fileType,\n        size: file.size,\n        bufferLength: fileBuffer.length\n      })\n    }\n\n    console.log('Form submission received:', {\n      name,\n      phone,\n      email,\n      message,\n      hasFile: !!fileBuffer,\n      fileName,\n      timestamp: new Date().toISOString()\n    })\n\n    // å‘é€é‚®ä»¶é€šçŸ¥ï¼ˆåŒ…å«é™„ä»¶ï¼‰\n    try {\n      await sendQuoteEmail({\n        name,\n        phone: phone || undefined,\n        email,\n        message: message || undefined,\n        attachment: fileBuffer ? {\n          filename: fileName!,\n          content: fileBuffer,\n          contentType: fileType || undefined,\n        } : undefined,\n      })\n      console.log('Email notification sent successfully')\n    } catch (emailError: any) {\n      console.error('Failed to send email notification:', emailError)\n      // å³ä½¿é‚®ä»¶å‘é€å¤±è´¥ï¼Œä¹Ÿè¿”å›æˆåŠŸï¼ˆé¿å…ç”¨æˆ·çœ‹åˆ°é”™è¯¯ï¼‰\n      // å¦‚æœéœ€è¦ä¸¥æ ¼å¤„ç†ï¼Œå¯ä»¥å–æ¶ˆä¸‹é¢çš„æ³¨é‡Š\n      // return NextResponse.json(\n      //   { \n      //     error: 'Failed to send notification email',\n      //     details: emailError.message\n      //   },\n      //   { status: 500 }\n      // )\n    }\n\n    return NextResponse.json(\n      { \n        success: true,\n        message: 'Form submitted successfully'\n      },\n      { status: 200 }\n    )\n  } catch (error: any) {\n    console.error('Error processing form submission:', error)\n    return NextResponse.json(\n      { \n        error: 'Failed to process form submission',\n        details: error.message || 'Unknown error'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,sBAAsB;QACtB,MAAM,WAAW,MAAM,QAAQ,QAAQ;QAEvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,QAAQ,SAAS,GAAG,CAAC;QAC3B,MAAM,QAAQ,SAAS,GAAG,CAAC;QAC3B,MAAM,UAAU,SAAS,GAAG,CAAC;QAC7B,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,SAAS;QACT,IAAI,CAAC,QAAQ,CAAC,OAAO;YACnB,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,SAAS;QACT,MAAM,aAAa;QACnB,IAAI,CAAC,WAAW,IAAI,CAAC,QAAQ;YAC3B,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAElB;QAEA,YAAY;QACZ,IAAI,aAA4B;QAChC,IAAI,WAA0B;QAC9B,IAAI,WAA0B;QAE9B,IAAI,QAAQ,KAAK,IAAI,GAAG,GAAG;YACzB,mBAAmB;YACnB,MAAM,UAAU,KAAK,OAAO,KAAK,OAAO;;YACxC,IAAI,KAAK,IAAI,GAAG,SAAS;gBACvB,OAAO,+QAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAA+B,GACxC;oBAAE,QAAQ;gBAAI;YAElB;YAEA,gBAAgB;YAChB,MAAM,QAAQ,MAAM,KAAK,WAAW;YACpC,aAAa,OAAO,IAAI,CAAC;YACzB,WAAW,KAAK,IAAI;YACpB,WAAW,KAAK,IAAI,IAAI;YAExB,mBAAmB;YACnB,IAAI,CAAC,KAAK,IAAI,IAAI,UAAU;gBAC1B,MAAM,MAAM,SAAS,KAAK,CAAC,KAAK,GAAG,IAAI;gBACvC,MAAM,YAAoC;oBACxC,OAAO;oBACP,QAAQ;oBACR,OAAO;oBACP,OAAO;oBACP,OAAO;oBACP,OAAO;oBACP,QAAQ;oBACR,OAAO;oBACP,QAAQ;gBACV;gBACA,IAAI,OAAO,SAAS,CAAC,IAAI,EAAE;oBACzB,WAAW,SAAS,CAAC,IAAI;gBAC3B;YACF;YAEA,QAAQ,GAAG,CAAC,kBAAkB;gBAC5B,MAAM;gBACN,MAAM;gBACN,MAAM,KAAK,IAAI;gBACf,cAAc,WAAW,MAAM;YACjC;QACF;QAEA,QAAQ,GAAG,CAAC,6BAA6B;YACvC;YACA;YACA;YACA;YACA,SAAS,CAAC,CAAC;YACX;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;QAEA,eAAe;QACf,IAAI;YACF,MAAM,IAAA,gIAAc,EAAC;gBACnB;gBACA,OAAO,SAAS;gBAChB;gBACA,SAAS,WAAW;gBACpB,YAAY,aAAa;oBACvB,UAAU;oBACV,SAAS;oBACT,aAAa,YAAY;gBAC3B,IAAI;YACN;YACA,QAAQ,GAAG,CAAC;QACd,EAAE,OAAO,YAAiB;YACxB,QAAQ,KAAK,CAAC,sCAAsC;QACpD,2BAA2B;QAC3B,qBAAqB;QACrB,4BAA4B;QAC5B,OAAO;QACP,kDAAkD;QAClD,kCAAkC;QAClC,OAAO;QACP,oBAAoB;QACpB,IAAI;QACN;QAEA,OAAO,+QAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,SAAS;QACX,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,+QAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,MAAM,OAAO,IAAI;QAC5B,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}