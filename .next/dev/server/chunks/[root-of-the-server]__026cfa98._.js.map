{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///D:/111work/steel-website-clone%20%281%29/lib/email.ts"],"sourcesContent":["import nodemailer from 'nodemailer'\r\n\r\n// 创建邮件传输器\r\nconst createTransporter = () => {\r\n  // 默认使用 QQ 邮箱配置\r\n  const host = process.env.SMTP_HOST || 'smtp.qq.com'\r\n  const port = parseInt(process.env.SMTP_PORT || '587')\r\n  const secure = process.env.SMTP_SECURE === 'true' || port === 465\r\n  \r\n  return nodemailer.createTransport({\r\n    host,\r\n    port,\r\n    secure, // true for 465, false for other ports\r\n    auth: {\r\n      user: process.env.SMTP_USER,\r\n      pass: process.env.SMTP_PASS, // QQ 邮箱需要使用授权码，不是密码\r\n    },\r\n  })\r\n}\r\n\r\n// 发送表单提交通知邮件\r\nexport async function sendQuoteEmail(data: {\r\n  name: string\r\n  phone?: string\r\n  email: string\r\n  message?: string\r\n}) {\r\n  const transporter = createTransporter()\r\n\r\n  // 收件人邮箱（从环境变量获取，如果没有则使用默认值）\r\n  const recipientEmail = process.env.RECIPIENT_EMAIL || '1011300569@qq.com'\r\n\r\n  // 邮件内容\r\n  const mailOptions = {\r\n    from: process.env.SMTP_FROM || process.env.SMTP_USER,\r\n    to: recipientEmail,\r\n    replyTo: data.email, // 回复地址设置为提交者的邮箱\r\n    subject: `New Quote Request from ${data.name}`,\r\n    html: `\r\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\r\n        <h2 style=\"color: #1f2937; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;\">\r\n          New Quote Request\r\n        </h2>\r\n        \r\n        <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 8px; margin: 20px 0;\">\r\n          <h3 style=\"color: #374151; margin-top: 0;\">Contact Information</h3>\r\n          \r\n          <p style=\"margin: 10px 0;\">\r\n            <strong style=\"color: #1f2937;\">Name:</strong> \r\n            <span style=\"color: #4b5563;\">${data.name}</span>\r\n          </p>\r\n          \r\n          <p style=\"margin: 10px 0;\">\r\n            <strong style=\"color: #1f2937;\">Email:</strong> \r\n            <a href=\"mailto:${data.email}\" style=\"color: #3b82f6; text-decoration: none;\">${data.email}</a>\r\n          </p>\r\n          \r\n          ${data.phone ? `\r\n          <p style=\"margin: 10px 0;\">\r\n            <strong style=\"color: #1f2937;\">Phone:</strong> \r\n            <a href=\"tel:${data.phone}\" style=\"color: #4b5563; text-decoration: none;\">${data.phone}</a>\r\n          </p>\r\n          ` : ''}\r\n        </div>\r\n        \r\n        ${data.message ? `\r\n        <div style=\"background-color: #ffffff; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;\">\r\n          <h3 style=\"color: #374151; margin-top: 0;\">Message</h3>\r\n          <p style=\"color: #4b5563; line-height: 1.6; white-space: pre-wrap;\">${data.message}</p>\r\n        </div>\r\n        ` : ''}\r\n        \r\n        <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 12px;\">\r\n          <p>This email was sent from the contact form on your website.</p>\r\n          <p>Submitted at: ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Shanghai' })}</p>\r\n        </div>\r\n      </div>\r\n    `,\r\n    text: `\r\nNew Quote Request\r\n\r\nContact Information:\r\nName: ${data.name}\r\nEmail: ${data.email}\r\n${data.phone ? `Phone: ${data.phone}` : ''}\r\n\r\n${data.message ? `Message:\\n${data.message}` : ''}\r\n\r\n---\r\nThis email was sent from the contact form on your website.\r\nSubmitted at: ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Shanghai' })}\r\n    `.trim(),\r\n  }\r\n\r\n  try {\r\n    const info = await transporter.sendMail(mailOptions)\r\n    console.log('Email sent successfully:', info.messageId)\r\n    return { success: true, messageId: info.messageId }\r\n  } catch (error: any) {\r\n    console.error('Error sending email:', error)\r\n    throw new Error(`Failed to send email: ${error.message}`)\r\n  }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,UAAU;AACV,MAAM,oBAAoB;IACxB,eAAe;IACf,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS,IAAI;IACtC,MAAM,OAAO,SAAS,QAAQ,GAAG,CAAC,SAAS,IAAI;IAC/C,MAAM,SAAS,QAAQ,GAAG,CAAC,WAAW,KAAK,UAAU,SAAS;IAE9D,OAAO,oNAAU,CAAC,eAAe,CAAC;QAChC;QACA;QACA;QACA,MAAM;YACJ,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC7B;IACF;AACF;AAGO,eAAe,eAAe,IAKpC;IACC,MAAM,cAAc;IAEpB,4BAA4B;IAC5B,MAAM,iBAAiB,QAAQ,GAAG,CAAC,eAAe,IAAI;IAEtD,OAAO;IACP,MAAM,cAAc;QAClB,MAAM,QAAQ,GAAG,CAAC,SAAS,IAAI,QAAQ,GAAG,CAAC,SAAS;QACpD,IAAI;QACJ,SAAS,KAAK,KAAK;QACnB,SAAS,CAAC,uBAAuB,EAAE,KAAK,IAAI,EAAE;QAC9C,MAAM,CAAC;;;;;;;;;;;0CAW+B,EAAE,KAAK,IAAI,CAAC;;;;;4BAK1B,EAAE,KAAK,KAAK,CAAC,iDAAiD,EAAE,KAAK,KAAK,CAAC;;;UAG7F,EAAE,KAAK,KAAK,GAAG,CAAC;;;yBAGD,EAAE,KAAK,KAAK,CAAC,iDAAiD,EAAE,KAAK,KAAK,CAAC;;UAE1F,CAAC,GAAG,GAAG;;;QAGT,EAAE,KAAK,OAAO,GAAG,CAAC;;;8EAGoD,EAAE,KAAK,OAAO,CAAC;;QAErF,CAAC,GAAG,GAAG;;;;2BAIY,EAAE,IAAI,OAAO,cAAc,CAAC,SAAS;YAAE,UAAU;QAAgB,GAAG;;;IAG3F,CAAC;QACD,MAAM,CAAC;;;;MAIL,EAAE,KAAK,IAAI,CAAC;OACX,EAAE,KAAK,KAAK,CAAC;AACpB,EAAE,KAAK,KAAK,GAAG,CAAC,OAAO,EAAE,KAAK,KAAK,EAAE,GAAG,GAAG;;AAE3C,EAAE,KAAK,OAAO,GAAG,CAAC,UAAU,EAAE,KAAK,OAAO,EAAE,GAAG,GAAG;;;;cAIpC,EAAE,IAAI,OAAO,cAAc,CAAC,SAAS;YAAE,UAAU;QAAgB,GAAG;IAC9E,CAAC,CAAC,IAAI;IACR;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,YAAY,QAAQ,CAAC;QACxC,QAAQ,GAAG,CAAC,4BAA4B,KAAK,SAAS;QACtD,OAAO;YAAE,SAAS;YAAM,WAAW,KAAK,SAAS;QAAC;IACpD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,MAAM,IAAI,MAAM,CAAC,sBAAsB,EAAE,MAAM,OAAO,EAAE;IAC1D;AACF"}},
    {"offset": {"line": 243, "column": 0}, "map": {"version":3,"sources":["file:///D:/111work/steel-website-clone%20%281%29/app/api/test-email/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { sendQuoteEmail } from '@/lib/email'\r\n\r\nexport async function GET(request: NextRequest) {\r\n  // 只在开发环境允许测试\r\n  if (process.env.NODE_ENV === 'production') {\r\n    return NextResponse.json(\r\n      { error: 'Test endpoint is only available in development' },\r\n      { status: 403 }\r\n    )\r\n  }\r\n\r\n  try {\r\n    // 发送测试邮件\r\n    const result = await sendQuoteEmail({\r\n      name: '测试用户',\r\n      phone: '13800138000',\r\n      email: 'test@example.com',\r\n      message: '这是一封测试邮件，用于测试邮件发送功能是否正常工作。',\r\n    })\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: '测试邮件已发送！请检查你的邮箱 1011300569@qq.com',\r\n      messageId: result.messageId,\r\n      config: {\r\n        smtpHost: process.env.SMTP_HOST || 'smtp.qq.com',\r\n        smtpPort: process.env.SMTP_PORT || '587',\r\n        recipientEmail: process.env.RECIPIENT_EMAIL || '1011300569@qq.com',\r\n        smtpUser: process.env.SMTP_USER ? '已配置' : '未配置',\r\n      },\r\n    })\r\n  } catch (error: any) {\r\n    console.error('测试邮件发送失败:', error)\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: '邮件发送失败',\r\n        details: error.message,\r\n        troubleshooting: [\r\n          '1. 检查 .env.local 文件中的 SMTP_USER 和 SMTP_PASS 是否正确',\r\n          '2. 确认 QQ 邮箱已开启 SMTP 服务',\r\n          '3. 确认使用的是授权码而不是密码',\r\n          '4. 检查网络连接是否正常',\r\n        ],\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,aAAa;IACb;;IAOA,IAAI;QACF,SAAS;QACT,MAAM,SAAS,MAAM,IAAA,gIAAc,EAAC;YAClC,MAAM;YACN,OAAO;YACP,OAAO;YACP,SAAS;QACX;QAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,WAAW,OAAO,SAAS;YAC3B,QAAQ;gBACN,UAAU,QAAQ,GAAG,CAAC,SAAS,IAAI;gBACnC,UAAU,QAAQ,GAAG,CAAC,SAAS,IAAI;gBACnC,gBAAgB,QAAQ,GAAG,CAAC,eAAe,IAAI;gBAC/C,UAAU,QAAQ,GAAG,CAAC,SAAS,GAAG,QAAQ;YAC5C;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,aAAa;QAC3B,OAAO,+QAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;YACP,SAAS,MAAM,OAAO;YACtB,iBAAiB;gBACf;gBACA;gBACA;gBACA;aACD;QACH,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}